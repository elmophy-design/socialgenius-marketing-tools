import express from 'express';
const router = express.Router();

// Generate value proposition
router.post('/generate', async (req, res) => {
    try {
        const { 
            businessName, 
            targetAudience, 
            problem, 
            solution, 
            uniqueValue,
            userId 
        } = req.body;

        // Validation
        if (!businessName || !targetAudience || !problem) {
            return res.status(400).json({
                success: false,
                error: 'Business name, target audience, and problem are required'
            });
        }

        // Generate variations (you can add AI logic here)
        const variations = [
            {
                template: 'problem-solution',
                text: `${businessName} helps ${targetAudience} who struggle with ${problem} by ${solution || 'providing innovative solutions'}${uniqueValue ? `, unlike competitors who ${uniqueValue}` : ''}.`,
                score: 85
            },
            {
                template: 'benefit-focused',
                text: `For ${targetAudience}, ${businessName} is the solution that ${solution || 'solves your problems'} so you can stop worrying about ${problem}.`,
                score: 78
            },
            {
                template: 'direct-approach',
                text: `${businessName}: ${solution || 'Solving'} ${problem} for ${targetAudience}.${uniqueValue ? ` ${uniqueValue}` : ''}`,
                score: 72
            }
        ];

        res.json({
            success: true,
            data: {
                variations,
                metadata: {
                    businessName,
                    targetAudience,
                    generatedAt: new Date().toISOString()
                }
            }
        });

    } catch (error) {
        console.error('Error generating value proposition:', error);
        res.status(500).json({
            success: false,
            error: 'Failed to generate value proposition'
        });
    }
});

// Send email with free guide
router.post('/send-email', async (req, res) => {
    try {
        const { email, brand, valueProp } = req.body;

        // Validate email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || !emailRegex.test(email)) {
            return res.status(400).json({
                success: false,
                error: 'Valid email is required'
            });
        }

        // TODO: Integrate with your email service (Brevo, SendGrid, etc.)
        console.log('ðŸ“§ Sending email to:', email);
        console.log('Brand:', brand);
        console.log('Value Prop:', valueProp);

        // Simulate email sending
        // In production, use actual email service:
        /*
        await sendEmail({
            to: email,
            subject: 'Your Free Marketing Guide',
            html: `<h1>Thanks for using our Value Proposition Generator!</h1>
                   <p>Your value proposition: ${valueProp}</p>
                   <p>Download your free guide: [link]</p>`
        });
        */

        res.json({
            success: true,
            message: 'Email sent successfully'
        });

    } catch (error) {
        console.error('Error sending email:', error);
        res.status(500).json({
            success: false,
            error: 'Failed to send email'
        });
    }
});

export default router;